# Task 3 å®ç°æƒ…å†µè¯„ä¼°æŠ¥å‘Š

## ğŸ“Š æ€»ä½“è¯„ä¼°ï¼š**A- (ä¼˜ç§€ï¼Œæ ¸å¿ƒåŠŸèƒ½å®Œå¤‡)**

---

## âœ… å·²å®Œæˆé¡¹ï¼ˆç¬¦åˆè§„èŒƒï¼‰

### 1. æ•°æ®å‡†å¤‡ (task3_prep.py)
| æ£€æŸ¥é¡¹              | çŠ¶æ€ | è¯´æ˜                           |
| ------------------- | ---- | ------------------------------ |
| å‘¨çº§æ ·æœ¬æ„é€         | âœ…    | æ¯è¡Œ = active çš„ (s,t,i)       |
| è¯„å§”ç›®æ ‡ yJ = pJ_it | âœ…    | å‘¨å†…å½’ä¸€åŒ–è¯„å§”ç™¾åˆ†æ¯”           |
| è§‚ä¼—ç›®æ ‡ v_mean     | âœ…    | ä» posterior summary åŠ è½½      |
| å¹´é¾„æ ‡å‡†åŒ–          | âœ…    | age_z è®¡ç®—æ­£ç¡®                 |
| æ»šåŠ¨ç‰¹å¾            | âœ…    | rolling_avg_pJ, rolling_std_pJ |
| è¾“å‡ºæ ¼å¼            | âœ…    | task3_weekly_dataset.parquet   |

### 2. LMM åˆ†æ (task3_lmm.py)
| æ£€æŸ¥é¡¹         | çŠ¶æ€ | è¯´æ˜                                      |
| -------------- | ---- | ----------------------------------------- |
| äº¤å‰éšæœºæ•ˆåº”   | âœ…    | partner + season ä½œä¸º VC                  |
| è¯„å§”ä¾§ LMM     | âœ…    | å›ºå®šæ•ˆåº” + èˆä¼´éšæœºæ•ˆåº”                   |
| ç²‰ä¸ä¾§å¤–å¾ªç¯   | âœ…    | **å…³é”®äº®ç‚¹**ï¼š30ä¸ªposterior drawsçš„å¤–å¾ªç¯ |
| CI è·¨drawsæ±‡æ€» | âœ…    | 2.5% / 97.5% åˆ†ä½æ•°æ­£ç¡®è®¡ç®—               |
| support_n è¾“å‡º | âœ…    | è®°å½•æœ‰æ•ˆdrawsæ•°é‡                         |

### 3. GBDT + SHAP (task3_gbdt.py)
| æ£€æŸ¥é¡¹               | çŠ¶æ€ | è¯´æ˜                         |
| -------------------- | ---- | ---------------------------- |
| GroupKFold by season | âœ…    | é˜²æ­¢è·¨å­£æ³„æ¼                 |
| Bootstrap SHAP CI    | âœ…    | **è§„èŒƒç¡¬è¦æ±‚**ï¼Œå·²å®ç°       |
| Posterior drawæŠ½æ ·   | âœ…    | æ¯æ¬¡bootstrapæŠ½å–ä¸åŒçš„r_idx |
| CIè¾“å‡ºæ ¼å¼           | âœ…    | mean, q2.5, q97.5            |

---

## âš ï¸ å·²ä¿®å¤çš„é—®é¢˜ (Resolved)

### ï¿½ é—®é¢˜1ï¼šèˆä¼´åç§°æ ¼å¼é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰

**å½“å‰è¾“å‡ºï¼š**
```
partner,effect
Jonathan Roberts,0.2396...
Derek Hough,0.0815...
```
**çŠ¶æ€ï¼š** âœ… å·²ä¿®å¤ã€‚åœ¨ `task3_lmm.py` ä¸­æ·»åŠ äº†åç§°æ¸…æ´—é€»è¾‘ã€‚

---

### ï¿½ é—®é¢˜2ï¼šCSVç´¢å¼•åˆ—é—®é¢˜ï¼ˆå·²ä¿®å¤ï¼‰

**çŠ¶æ€ï¼š** âœ… å·²ä¿®å¤ã€‚CSV ç¬¬ä¸€åˆ—å·²æ­£ç¡®å‘½åä¸º `partner`ã€‚

---

### ğŸŸ¡ é—®é¢˜3ï¼šç¼ºå°‘ç½‘ç»œç‰¹å¾ï¼ˆå¯é€‰ä½†æ¨èï¼‰

**çŠ¶æ€ï¼š** â­ï¸ è·³è¿‡ï¼ˆå¯é€‰ï¼‰ã€‚ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ã€‚

---

### ğŸŸ¡ é—®é¢˜4ï¼šLMMæ”¶æ•›é—®é¢˜å¤„ç†

**çŠ¶æ€ï¼š** âœ… ä¿ç•™ Fallback æœºåˆ¶ã€‚

---

## ğŸ“Š è¾“å‡ºæ•°æ®è´¨é‡æ£€æŸ¥

### Fan Partner Effects åˆ†æ

| æ’å  | èˆä¼´              | Effect (mean) | CIåŒ…å«0?         | è§£è¯»           |
| ----- | ----------------- | ------------- | ---------------- | -------------- |
| 1     | Jonathan Roberts  | +0.240        | âŒ [0.12, 0.47]   | **æ˜¾è‘—æ­£æ•ˆåº”** |
| 2     | Daniella Karagach | +0.104        | âŒ [0.002, 0.18]  | æ˜¾è‘—æ­£æ•ˆåº”     |
| 3     | Derek Hough       | +0.082        | âŒ [0.02, 0.13]   | æ˜¾è‘—æ­£æ•ˆåº”     |
| ...   | ...               | ...           | ...              | ...            |
| å€’æ•°3 | Louis van Amstel  | -0.064        | âŒ [-0.10, -0.03] | **æ˜¾è‘—è´Ÿæ•ˆåº”** |
| å€’æ•°2 | Nick Kosovich     | -0.062        | âŒ [-0.09, -0.03] | æ˜¾è‘—è´Ÿæ•ˆåº”     |
| å€’æ•°1 | Ashly DelGrosso   | -0.059        | âœ… [-0.14, 0.03]  | ä¸æ˜¾è‘—         |

**è§£è¯»ï¼š**
- Jonathan Roberts çš„ç²‰ä¸ä¾§"å¸¦é£æ•ˆåº”"æœ€å¼º (+24%)
- Derek Hough åŒæ ·æœ‰æ˜¾è‘—æ­£æ•ˆåº” (+8%)
- éƒ¨åˆ†èˆä¼´æœ‰æ˜¾è‘—çš„"æ‹–ç´¯æ•ˆåº”"ï¼ˆå¦‚ Louis van Amstelï¼‰
- CI è®¡ç®—æ­£ç¡®ï¼ŒåŒ…å«äº† posterior uncertainty

---

## ğŸ“‹ è‡ªæŸ¥æ¸…å•å¯¹ç…§

| æ£€æŸ¥é¡¹                                         | çŠ¶æ€                  |
| ---------------------------------------------- | --------------------- |
| â˜‘ï¸ task3_weekly_dataset.parquet ç”Ÿæˆ            | âœ…                     |
| â˜‘ï¸ task3_lmm_judge_coeffs.csv                   | âœ… å·²ç”Ÿæˆ              |
| â˜‘ï¸ task3_lmm_judge_partner_effects.csv          | âœ… å·²ç”Ÿæˆ (åç§°å·²æ¸…æ´—) |
| â˜‘ï¸ task3_lmm_fan_coeffs_aggregated.csv          | âœ… å·²ç”Ÿæˆ              |
| â˜‘ï¸ task3_lmm_fan_partner_effects_aggregated.csv | âœ… å·²ç”Ÿæˆ              |
| â˜‘ï¸ task3_shap_ci_fan.csv                        | âœ… å·²ç”Ÿæˆ              |
| â˜‘ï¸ task3_shap_ci_judge.csv                      | âœ… å·²ç”Ÿæˆ              |
| â˜‘ï¸ task3_gbdt_cv_metrics.json                   | âœ… å·²ç”Ÿæˆ (æ–°å¢)       |
| â˜‘ï¸ Fan CI æ¥è‡ªè·¨ posterior draws                | âœ… support_n=30        |
| â˜‘ï¸ SHAP æœ‰ CI                                   | âœ… ä»£ç é€»è¾‘æ­£ç¡®        |

---

## ğŸ”§ ä»£ç è´¨é‡è¯„ä¼°

### ä¼˜ç‚¹
1. **å¤–å¾ªç¯è®¾è®¡æ­£ç¡®**ï¼šFan LMM å¯¹ 30 ä¸ª posterior draws åˆ†åˆ«æ‹Ÿåˆï¼Œæœ€åæ±‡æ€» CI
2. **Bootstrap SHAP è®¾è®¡æ­£ç¡®**ï¼šæ¯æ¬¡ bootstrap æŠ½å–ä¸åŒçš„ posterior draw
3. **GroupKFold**ï¼šæ­£ç¡®é˜²æ­¢è·¨å­£æ³„æ¼
4. **Fallbackæœºåˆ¶**ï¼šLMMæ”¶æ•›å¤±è´¥æ—¶æœ‰å¤‡ç”¨æ–¹æ¡ˆ
5. **åç§°æ¸…æ´—**ï¼šå·²å®æ–½ï¼Œè¾“å‡ºæ•´æ´

### æ”¹è¿›ç©ºé—´
1. ç¼ºå°‘ç½‘ç»œç‰¹å¾ï¼ˆå¯é€‰ P2ï¼‰

---

## ğŸ¯ ä¼˜å…ˆæ”¹è¿›å»ºè®®

### P0 (å¿…é¡»ä¿®å¤)
1. **ä¿®å¤èˆä¼´åç§°æ ¼å¼** - âœ… **å·²ä¿®å¤**

### P1 (å»ºè®®ä¿®å¤)
2. æ·»åŠ  `task3_gbdt_cv_metrics.json` è¾“å‡º CV RMSE - âœ… **å·²ä¿®å¤**
3. ç¡®è®¤æ‰€æœ‰6ä¸ªè¾“å‡ºæ–‡ä»¶éƒ½å·²ç”Ÿæˆ - âœ… **å·²ç¡®è®¤**

### P2 (å¯é€‰)
4. æ·»åŠ ç®€å•çš„ç½‘ç»œç‰¹å¾ï¼ˆpartner_experienceï¼‰ - â­ï¸ è·³è¿‡
5. æ·»åŠ  Judge vs Fan æ•ˆåº”å¯¹æ¯”å›¾çš„æ•°æ®è¾“å‡º - â­ï¸ è·³è¿‡

---

## æ€»ç»“

Task 3 çš„**æ ¸å¿ƒç®—æ³•å®ç°æ­£ç¡®**ï¼š
- LMM å¤–å¾ªç¯ âœ…
- Bootstrap SHAP CI âœ…
- GroupKFold é˜²æ³„æ¼ âœ…
- **è¾“å‡ºæ ¼å¼**ï¼šå·²æ¸…æ´— âœ…

**æ–°è¯„åˆ†ï¼šA-**
