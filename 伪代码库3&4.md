# Task 3 Implementation Blueprint
**归因分析：职业舞者 + 明星特征对评委分与观众票的影响**

## 1. Analysis & Model Selection

### Problem Classification
*   **双目标归因建模 (Multi-target Effect Attribution)**:
    *   Goal A: 评委打分 (技术信号) $y^J$.
    *   Goal B: 观众支持 (人气信号) $y^F$ (from Task 1).
*   **层次结构 (Hierarchical)**: 同一职业舞者跨季出现。
*   **CS 强化**: 图表示学习 (Node2Vec) + SHAP。

### Models
*   **Primary**: 双目标 GBDT (XGBoost/LightGBM) + SHAP + 图嵌入。
*   **Baseline**: 混合效应模型 (Mixed-Effects Model) —— 用于提供可解释的“舞伴随机效应”作为对照。

## 2. The Master Library

### 2.1 Mathematical Model (Formulas)

#### 2.1.1 标签定义
*   **评委表现** (周内归一):
    $$ y^J_{i,t} = \frac{S_{i,t}}{\sum_{k\in\mathcal{A}_t} S_{k,t}} $$
*   **观众支持** (Task 1 潜变量):
    $$ y^F_{i,t} = u_{i,t} $$

#### 2.1.2 Baseline: Mixed-Effects Model
$$ Y_{i,t} = \beta_0 + \beta^\top X_{i,t} + b_{\mathrm{partner}(i)} + b_{\mathrm{season}(s)} + \varepsilon_{i,t} $$
*   $b_{\mathrm{partner}}$: 舞伴随机效应（带飞系数）。

#### 2.1.3 Primary: Dual-Target GBDT
$$ \hat y^J_{i,t} = f_J(X_{i,t}), \qquad \hat y^F_{i,t} = f_F(X_{i,t}) $$
*   **Weighted Loss** (for Vote Model):
    $$ w_{i,t} = \frac{1}{\mathrm{Var}(y^F_{i,t})+\epsilon_w} $$
    (使用 Task 1 的不确定性进行加权)

#### 2.1.4 Explainability: SHAP
$$ \phi_j = \sum_{S\subseteq F\setminus\{j\}} \frac{|S|!\,(|F|-|S|-1)!}{|F|!}\left[f_{S\cup\{j\}}(x)-f_S(x)\right] $$

#### 2.1.5 Graph Embeddings
构建二部图 $G=(V_C\cup V_P, E)$。
*   **边权**: $w_{c,p} = \sum y_{c,t}$.
*   **Embedding**: Node2Vec 学习 $z_p \in \mathbb{R}^d$，拼接入 $X_{i,t}$。

### 2.2 Algorithmic Logic (Pseudo-code)

*   **Step 0: Dataset Construction**
    *   Rows: $i \in \mathcal{A}_t$ for all $s, t$.
    *   Targets: $y^J_{i,t}$ and $y^F_{i,t}$ (with weights $w_{i,t}$).
    *   Features $X_{i,t}$: Static, Process, History, PartnerID, **PartnerEmbedding**.
*   **Step 1: Baseline (LMM)**
    *   Fit LMM on $y^J$ and $y^F$. Extract $\hat b_{\mathrm{partner}}$.
*   **Step 2: Primary (GBDT)**
    *   Group CV by Season. Train $f_J, f_F$.
*   **Step 3: Attribution**
    *   Compute SHAP. Compare $\phi^{(J)}$ vs $\phi^{(F)}$.
    *   Generate Top-Partner Lists.
*   **Step 4: Ablation**
    *   Test performance without Graph Embeddings.

---

# Task 4 Implementation Blueprint
**新赛制设计：更公平/更精彩/更鲁棒**

## 1. Analysis & Model Selection

*   **机制设计 (Mechanism Design)** + **多目标优化 (Multi-objective)**.
*   **Primary**: 参数化新规则 + Monte Carlo 回放 + Pareto 搜索。
*   **Baseline**: 固定权重线性融合 (e.g., 50/50).

## 2. The Master Library

### 2.1 Mathematical Model

#### 2.1.1 基础归一化
$$ p^J_{i,t} = \frac{S_{i,t}}{\sum_{k\in\mathcal{A}_t}S_{k,t}}, \qquad p^F_{i,t} = v_{i,t} $$

#### 2.1.2 票的“抗极端”压缩
$$ \tilde p^F_{i,t} = \frac{(p^F_{i,t})^\eta}{\sum_{k\in\mathcal{A}_t}(p^F_{k,t})^\eta}, \qquad \eta \in (0,1] $$
*   $\eta < 1$: 压缩头部优势，防止 Bobby-type 刷票。

#### 2.1.3 动态权重融合
$$ C_{i,t} = w_t p^J_{i,t} + (1-w_t) \tilde p^F_{i,t} $$
*   **Weight Function**:
    $$ w_t = \sigma(a(t-b)) = \frac{1}{1+e^{-a(t-b)}} $$

#### 2.1.4 淘汰机制 (Judges' Save)
*   **Bottom-Two**: $\mathcal{B}_t = \text{two lowest by } C_{i,t}$.
*   **Probabilistic Save**:
    $$ \Pr(e_t=i \mid \mathcal{B}_t=\{i,j\}) = \sigma(\gamma(S_{j,t}-S_{i,t})) $$

#### 2.1.5 Objectives
*   **Audience Alignment**: $Obj_F = \rho_S(\mathrm{rank}(\bar p^F), \mathrm{rank}(P_\theta))$
*   **Judge Alignment**: $Obj_J = \rho_S(\mathrm{rank}(\bar p^J), \mathrm{rank}(P_\theta))$
*   **Robustness**: $Obj_R = -\mathbb{E}[d_K(P_\theta, P_\theta^{\text{pert}})]$
*   **Drama**: $Obj_D = \frac{1}{T}\sum_t \exp(-m_t/\tau)$

### 2.2 Pareto Optimization Process
*   **Step 1**: Define Evaluate($\theta$) using SeasonSimulator.
*   **Step 2**: Apply Perturbation (Simulate Vote Rigging).
*   **Step 3**: Search (Grid/Random/Bayesian) for $\theta=(a,b,\eta,\gamma)$.
*   **Step 4**: Identify Pareto Front & Knee Point.

## 3. Visual & Table Library

*   **Fig 4.1**: Pareto Front Scatter Plot ($Obj_J$ vs $Obj_F$).
*   **Fig 4.2**: Recommended Dynamic Weight Curve $w_t$.
*   **Fig 4.3**: Robustness Curve ($\kappa$ vs Champion Change Rate).
*   **Tab 4.2**: Top-10 Candidate Rules.

## 4. Symbol Dictionary Additions

*   $\tilde p^F$: Compressed vote share
*   $\eta$: Compression exponent
*   $w_t$: Dynamic weight
*   $d_K$: Kendall distance
*   $\theta$: Rule parameter vector